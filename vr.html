<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <!-- <script src="https://unpkg.com/aframe-look-at-component@0.5.1/dist/aframe-look-at-component.min.js"></script> -->
    <script>
      AFRAME.registerComponent('follow-on-click', {
        init: function () {
          let el = this.el;
          el.addEventListener('click', function () {
            let cam = document.querySelector("#camera");
            let camPos = cam.getAttribute('position');
            let annie = document.querySelector("#Annie");
            let anniePos = annie.getAttribute('position');
            annie.setAttribute('position', {x: camPos.x, y: camPos.y - 4, z: camPos.z - 6});
            var annieEls = document.querySelectorAll(".AnnieElt");
            annieEls.forEach(function(elt) {
              elt.setAttribute('color', '#4444FF');
            });
          });
          el.addEventListener('mouseenter', function() {
            let cam = document.querySelector("#camera");
            let camPos = cam.getAttribute('position');
            let annie = document.querySelector("#Annie");
            let anniePos = annie.getAttribute('position');
            let annieRot = annie.getAttribute('rotation');
            console.log(annieRot);
            let xRot = camPos.x - anniePos.x;
            let zRot = camPos.z - anniePos.z;
            let rot = Math.atan(xRot / zRot);
            console.log("x's: " + xRot);
            console.log("z's: " + zRot);
            rot = (rot * 180) / Math.PI;
            if(xRot < 0 && zRot < 0) {
              rot = -180 + rot;
            } else if (xRot > 0 && zRot < 0) {
              rot = 180 - rot;
            }
            console.log(rot);
            annie.setAttribute('rotation', {x: annieRot.x, y: rot, z: annieRot.z});
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- START CAMERA -->
    <a-entity id="camera" camera="active: true" look-controls wasd-controls position="0 0 0" data-aframe-default-camera>
      <a-cursor></a-cursor>
    </a-entity>
    <!-- END CAMERA -->

    <!-- START ANNIE -->
		<a-entity id="Annie" position="0 -4 -6">
      <!-- START BODY -->
			<a-entity id="body" position="0 2 0">
				<a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" position="0 0 0" width="2" height="2" depth="4" follow-on-click></a-box>
			</a-entity>
      <!-- END BODY -->
      <!-- START LEGS -->
			<a-entity id="legs" position="0 0 0">
        <!-- START FRONT RIGHT LEG -->
        <a-entity id="front-right-leg" position="-0.74 0.5 1.25">
					<a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" width="0.5" height="2.5" depth="0.5" position="0 0 0"></a-box>
          <a-animation attribute="rotation"
								 dur="1000"
								 direction="alternate"
                 from="30 0 0"
								 to="-30 0 0"
								 repeat="indefinite"
								 easing="linear"></a-animation>
				</a-entity>
        <!-- END FRONT RIGHT LEG -->
        <!-- START FRONT LEFT LEG -->
        <a-entity id="front-left-leg" position="0.74 0.5 1.25">
  				<a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" width="0.5" height="2.5" depth="0.5" position="0 0 0"></a-box>
          <a-animation attribute="rotation"
                 dur="1000"
                 direction="alternate"
                 from="-30 0 0"
                 to="30 0 0"
                 repeat="indefinite"
                 easing="linear"></a-animation>
        </a-entity>
        <!-- END FRONT LEFT LEG -->
        <!-- START BACK RIGHT LEG -->
        <a-entity id="back-right-leg" position="-0.74 0.5 -1.25">
          <a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" width="0.5" height="2.5" depth="0.5" position="0 0 0"></a-box>
          <a-animation attribute="rotation"
                 dur="1000"
                 direction="alternate"
                 from="-30 0 0"
                 to="30 0 0"
                 repeat="indefinite"
                 easing="linear"></a-animation>
        </a-entity>
        <!-- END BACK RIGHT LEG -->
        <!-- START BACK LEFT LEG -->
        <a-entity id="back-left-leg" position="0.74 0.5 -1.25">
				      <a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" width="0.5" height="2.5" depth="0.5" position="0 0 0"></a-box>
              <a-animation attribute="rotation"
                     dur="1000"
                     direction="alternate"
                     from="30 0 0"
                     to="-30 0 0"
                     repeat="indefinite"
                     easing="linear"></a-animation>
        </a-entity>
        <!-- END BACK LEFT LEG -->
      </a-entity>
      <!-- END LEGS -->
      <!-- START HEAD -->
			<a-entity id="head" position="0 4 0">
				<a-box class="AnnieElt" src="https://mathymcmatherson.github.io/anniewebsitestatic/images/cow.jpg" position="0 0 1.5" width="2" height="2" depth="2" follow-on-click></a-box>
        <!-- START EARS -->
				<a-entity id="ears" position="0 1.25 2.25">
					<a-box class="AnnieElt" position="-0.75 0 0" color="#444444" width="0.5" height="0.5" depth="0.5"></a-box>
					<a-box class="AnnieElt" position="0.75 0 0" color="#444444" width="0.5" height="0.5" depth="0.5"></a-box>
				</a-entity>
        <!-- END EARS -->
			</a-entity>
      <!-- END HEAD -->
		</a-entity>
    <!-- END ANNIE -->



		<a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>
</html>
